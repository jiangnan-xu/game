<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Memory! Â· Level 33</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Shippori+Mincho:wght@500;700&family=Zen+Maru+Gothic:wght@400;700&display=swap" rel="stylesheet">

<style>
:root{
  --title-font: "Shippori Mincho", serif;
  --ui-font: "Inter", "Zen Maru Gothic", system-ui, sans-serif;
}

html,body{
  margin:0; padding:0; height:100%;
  background:#000;
  overflow:hidden;
  font-family:var(--ui-font);
}

#intro{ position:fixed; inset:0; background:#000; }

/* ===== Title ===== */
#title-layer{
  position:absolute; inset:0;
  display:flex; align-items:center; justify-content:center;
  text-align:center; color:#fff;
  z-index:10; pointer-events:none;
  transition:opacity .5s ease;
  background:
    radial-gradient(circle at 50% 35%, rgba(255,255,255,.12), rgba(0,0,0,.92) 65%);
}
.title-wrap{ max-width:780px; padding:24px; }
.kicker{ letter-spacing:.35em; font-size:12px; opacity:.75; margin-bottom:16px; }
.title{
  font-family:var(--title-font);
  font-size:clamp(44px,6vw,68px);
  font-weight:700;
  line-height:1.05;
  text-shadow:0 20px 80px rgba(0,0,0,.8);
}
.subtitle{ margin-top:14px; font-size:14px; opacity:.85; }

/* ===== Scene ===== */
#scene{
  position:absolute; inset:0;
  opacity:0; transition:opacity .6s ease;
}

/* Camera layer (image + hotspots + lock stay aligned) */
#camera{
  position:absolute; inset:0;
  transform-origin: 50% 50%;
  will-change: transform;
}
#scene-img{
  width:100%;
  height:100%;
  object-fit:cover;
  display:block;
}

/* ===== Hotspots ===== */
.hotspot{
  position:absolute;
  border:none;
  background:transparent;
  cursor:pointer;
  z-index:4;
  opacity:0;                 /* hidden until locked-level */
  pointer-events:none;
  transition: opacity .35s ease;
}

/* visible hotspot emphasis only when enabled */
.hotspot.enabled{
  opacity:1;
  pointer-events:auto;
}

.hotspot.enabled.show-area{
  border-radius: 18px;
  outline: 2px solid rgba(255,255,255,0.18);
  box-shadow:
    0 0 0 6px rgba(255,255,255,0.04),
    0 18px 60px rgba(0,0,0,0.22);
  background: radial-gradient(circle at 50% 35%,
    rgba(255,255,255,0.08),
    rgba(255,255,255,0.02) 55%,
    rgba(255,255,255,0) 70%);
  animation: areaPulse 1.8s ease-in-out infinite;
}
@keyframes areaPulse{
  0%{ opacity:.75; transform: translateZ(0) scale(1); }
  50%{ opacity:1; transform: translateZ(0) scale(1.01); }
  100%{ opacity:.78; transform: translateZ(0) scale(1); }
}

/* ===== Bell marker (pretty, not weird) ===== */
#bell-marker{
  position:absolute;
  transform: translate(-50%,-50%);
  z-index:5;
  pointer-events:none;
  opacity:0;                 /* appears at locked-level */
  transition: opacity .35s ease;
  display:flex;
  align-items:center;
  gap:8px;
}
#bell-marker.enabled{ opacity:1; }

.bell-dot{
  width:18px;height:18px;border-radius:999px;
  background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.95), rgba(255,210,150,.55) 50%, rgba(255,255,255,0) 70%);
  box-shadow: 0 10px 30px rgba(0,0,0,.35);
  position:relative;
}
.bell-dot::after{
  content:"";
  position:absolute;
  inset:-10px;
  border-radius:999px;
  border:1px solid rgba(255,220,160,.20);
  animation: ring 1.6s ease-in-out infinite;
}
@keyframes ring{
  0%{ transform: scale(0.85); opacity:.12; }
  50%{ transform: scale(1.15); opacity:.32; }
  100%{ transform: scale(0.85); opacity:.12; }
}
.bell-text{
  font-size:12px;
  color: rgba(255,255,255,.92);
  background: rgba(0,0,0,.36);
  border: 1px solid rgba(255,255,255,.12);
  padding: 8px 10px;
  border-radius: 999px;
  backdrop-filter: blur(6px);
}

/* ===== Hint Layer (scroll after lock-level) ===== */
#hint-layer{
  position:absolute;
  inset:0;
  z-index:6;
  pointer-events:none;
  opacity:0;
  transition: opacity .35s ease;
}
#hint-layer.enabled{ opacity:1; }

.hint-card{
  position:absolute;
  left:50%;
  bottom: 34px;
  transform: translateX(-50%);
  width: min(520px, 92vw);
  border-radius: 18px;
  padding: 14px 16px;
  color: rgba(255,255,255,0.92);
  background: rgba(0,0,0,0.42);
  border: 1px solid rgba(255,255,255,0.14);
  box-shadow: 0 22px 80px rgba(0,0,0,0.40);
  backdrop-filter: blur(8px);
}

.hint-title{
  font-family: "Zen Maru Gothic", var(--ui-font);
  font-weight: 800;
  letter-spacing: .06em;
  font-size: 12px;
  opacity: .85;
  margin-bottom: 6px;
}

.hint-text{
  font-size: 14px;
  line-height: 1.55;
}

.hint-dots{
  margin-top: 10px;
  display:flex;
  gap:6px;
  justify-content:center;
  opacity:.8;
}
.dot{
  width:6px;height:6px;border-radius:999px;
  background: rgba(255,255,255,0.25);
}
.dot.on{ background: rgba(255,255,255,0.75); }

/* ===== Lock panel (small + closable) ===== */
#door-lock{
  position:absolute;
  z-index:7;
  display:none;
  width: min(320px, 76vw);
  padding: 12px 12px 10px;
  border-radius: 16px;
  background: rgba(255,255,255,.90);
  border: 1px solid rgba(255,255,255,.45);
  box-shadow: 0 24px 70px rgba(0,0,0,.42);
  backdrop-filter: blur(10px);
}
#door-lock.show{ display:block; }

.lock-top{ display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:6px; }
.lock-title{ font-family:"Zen Maru Gothic"; font-weight:800; font-size:14px; color:#111827; }
.lock-close{
  width:32px;height:32px;border-radius:999px;
  border: 1px solid rgba(17,24,39,.10);
  background: rgba(17,24,39,.05);
  cursor:pointer;
  font-weight:900;
}
.lock-sub{ font-size:12px; color:#374151; margin-bottom:8px; }

.lock-wheels{ display:flex; justify-content:center; gap:10px; margin: 8px 0 8px; }
.wheel{
  width:42px; height:64px;
  border-radius:14px;
  background:linear-gradient(#eef2ff,#dbeafe);
  border:1px solid #bfdbfe;
  display:flex; align-items:center; justify-content:center;
  font-family:"Zen Maru Gothic"; font-size:22px; font-weight:900;
  cursor:grab; user-select:none;
}
.unlock-btn{
  width:100%;
  padding:9px 12px;
  border-radius:999px;
  border:none;
  font-weight:900;
  cursor:pointer;
  background:linear-gradient(135deg,#fde68a,#fb923c);
}
.hint-message{ margin-top:8px; color:#b91c1c; font-weight:800; min-height:16px; font-size:12px; }

/* Toast */
#toast{
  position:absolute;
  left:50%; top: 18px;
  transform:translateX(-50%);
  padding:10px 14px;
  background:rgba(0,0,0,.6);
  color:#fff;
  border-radius:999px;
  font-size:14px;
  opacity:0;
  transition:.2s;
  z-index:20;
}
#toast.show{ opacity:1; transform:translate(-50%, -6px); }
</style>
</head>

<body>
<div id="intro">

  <div id="title-layer">
    <div class="title-wrap">
      <div class="kicker">LEVEL 33</div>
      <div class="title">Memory Door</div>
      <div class="subtitle">Scroll to approach the door.</div>
    </div>
  </div>

  <div id="scene">
    <div id="camera">
      <img id="scene-img" src="door-bg.jpg" alt="Door hallway background"/>

      <button id="door-hotspot" class="hotspot door" aria-label="Door"></button>
      <button id="bell-hotspot" class="hotspot bell" aria-label="Doorbell"></button>

      <div id="bell-marker" aria-hidden="true">
        <div class="bell-dot"></div>
        <div class="bell-text">bell</div>
      </div>

      <div id="door-lock" aria-hidden="true">
        <div class="lock-top">
          <div class="lock-title">Itâ€™s locked.</div>
          <button id="lock-close" class="lock-close" aria-label="Close">âœ•</button>
        </div>
        <div class="lock-sub">Enter the first code.</div>
        <div class="lock-wheels" id="lock-wheels"></div>
        <button class="unlock-btn" id="unlock-btn">Unlock</button>
        <div class="hint-message" id="hint-message"></div>
      </div>
    </div>

    <!-- Hints that appear only at locked-level -->
    <div id="hint-layer" aria-hidden="true">
      <div class="hint-card">
        <div class="hint-title" id="hint-title">HINT</div>
        <div class="hint-text" id="hint-text"></div>
        <div class="hint-dots" id="hint-dots"></div>
      </div>
    </div>

    <div id="toast" role="status" aria-live="polite"></div>
  </div>
</div>

<audio id="song" src="song.m4a" preload="auto"></audio>

<script>
/* ===================== CONFIG ===================== */
const CFG = {
  code: "MEMORY",                 // change freely
  focus: { x: 0.44, y: 0.52 },     // where to zoom toward
  zoomMin: 1.0,
  zoomMax: 1.85,

  // When progress reaches 1, camera locks; scroll becomes "hint scroll"
  lockProgress: 1.0,

  // Hotspot rectangles (normalized inside camera)
  door: { x: 0.34, y: 0.18, w: 0.28, h: 0.66 },
  bell: { x: 0.60, y: 0.46, w: 0.06, h: 0.09 }, // set to "above the white switch"
  lock: { x: 0.50, y: 0.44 },                    // lock panel center on door
  bellMarker: { x: 0.60, y: 0.45 },

  hints: [
    { title: "AT THIS DISTANCE", text: "Two small things matter: the bellâ€¦ and the door." },
    { title: "THE BELL",         text: "Try the bell. It may reveal something you canâ€™t see." },
    { title: "THE DOOR",         text: "Itâ€™s closed. If you want in, youâ€™ll need the first code." }
  ]
};

/* ===================== ELEMENTS ===================== */
const scene = document.getElementById("scene");
const titleLayer = document.getElementById("title-layer");
const camera = document.getElementById("camera");

const doorBtn = document.getElementById("door-hotspot");
const bellBtn = document.getElementById("bell-hotspot");
const bellMarker = document.getElementById("bell-marker");

const lockPanel = document.getElementById("door-lock");
const lockClose = document.getElementById("lock-close");
const wheelsEl = document.getElementById("lock-wheels");
const unlockBtn = document.getElementById("unlock-btn");
const hintMsg = document.getElementById("hint-message");

const hintLayer = document.getElementById("hint-layer");
const hintTitle = document.getElementById("hint-title");
const hintText = document.getElementById("hint-text");
const hintDots = document.getElementById("hint-dots");

const toast = document.getElementById("toast");
const song = document.getElementById("song");

/* ===================== STATE ===================== */
let progress = 0;        // 0..1 zoom approach
let cameraLocked = false;
let lockOpen = false;
let hintIndex = 0;

/* ===================== HELPERS ===================== */
function clamp01(v){ return Math.max(0, Math.min(1, v)); }
function showToast(msg){
  toast.textContent = msg;
  toast.classList.add("show");
  setTimeout(() => toast.classList.remove("show"), 900);
}

function setRect(el, r){
  el.style.left   = (r.x * 100) + "%";
  el.style.top    = (r.y * 100) + "%";
  el.style.width  = (r.w * 100) + "%";
  el.style.height = (r.h * 100) + "%";
}
function setPoint(el, p){
  el.style.left = (p.x * 100) + "%";
  el.style.top  = (p.y * 100) + "%";
  el.style.transform = "translate(-50%, -50%)";
}

function enableLockedUI(on){
  // show hotspots + marker + hints only at locked level
  doorBtn.classList.toggle("enabled", on);
  bellBtn.classList.toggle("enabled", on);
  bellMarker.classList.toggle("enabled", on);

  // optional: show soft area highlight when locked (discoverable)
  doorBtn.classList.toggle("show-area", on);
  bellBtn.classList.toggle("show-area", on);

  hintLayer.classList.toggle("enabled", on);
  hintLayer.setAttribute("aria-hidden", (!on).toString());
}

function renderHint(){
  const h = CFG.hints[hintIndex];
  hintTitle.textContent = h.title;
  hintText.textContent = h.text;

  hintDots.innerHTML = "";
  for (let i=0; i<CFG.hints.length; i++){
    const d = document.createElement("div");
    d.className = "dot" + (i === hintIndex ? " on" : "");
    hintDots.appendChild(d);
  }
}

function applyCamera(){
  // fade title -> scene as we approach
  const show = clamp01((progress - 0.10) / 0.30);
  scene.style.opacity = show.toFixed(3);
  titleLayer.style.opacity = (1 - show).toFixed(3);

  // zoom curve into the door
  const t = clamp01(progress);
  const zoom = CFG.zoomMin + (CFG.zoomMax - CFG.zoomMin) * (t * t);

  const vw = window.innerWidth;
  const vh = window.innerHeight;
  const dx = (0.5 - CFG.focus.x) * vw * (zoom - 1);
  const dy = (0.5 - CFG.focus.y) * vh * (zoom - 1);

  camera.style.transform = `translate(${dx}px, ${dy}px) scale(${zoom})`;
}

function maybeLockCamera(){
  if (!cameraLocked && progress >= CFG.lockProgress){
    progress = CFG.lockProgress;     // snap to locked level
    cameraLocked = true;
    enableLockedUI(true);
    renderHint();
    showToast("Reached the door.");
  }
}

/* ===================== POSITION UI ===================== */
setRect(doorBtn, CFG.door);
setRect(bellBtn, CFG.bell);
setPoint(lockPanel, CFG.lock);
setPoint(bellMarker, CFG.bellMarker);

enableLockedUI(false);
applyCamera();

window.addEventListener("resize", applyCamera);

/* ===================== SCROLL LOGIC ===================== */
/*
  Phase A: (cameraLocked=false)  => scroll controls progress (zoom in/out)
  Phase B: (cameraLocked=true)   => scroll controls hintIndex (NO zoom)
*/
window.addEventListener("wheel", (e) => {
  e.preventDefault();

  if (!cameraLocked){
    // Approach zoom
    progress = clamp01(progress - e.deltaY * 0.0007);
    applyCamera();
    maybeLockCamera();
    return;
  }

  // Camera is locked: scroll cycles hints (only if lock UI not open)
  if (lockOpen) return;

  if (e.deltaY > 0){
    hintIndex = Math.min(CFG.hints.length - 1, hintIndex + 1);
  } else {
    hintIndex = Math.max(0, hintIndex - 1);
  }
  renderHint();
}, { passive:false });

/* ===================== INTERACTIONS ===================== */
bellBtn.addEventListener("click", () => {
  showToast("ðŸ”” Ding...");
  try{
    song.currentTime = 0;
    song.play().catch(()=>{});
  }catch(_){}
});

function openLock(){
  lockOpen = true;
  lockPanel.classList.add("show");
  lockPanel.setAttribute("aria-hidden", "false");
  hintMsg.textContent = "";
}

function closeLock(){
  lockOpen = false;
  lockPanel.classList.remove("show");
  lockPanel.setAttribute("aria-hidden", "true");
  hintMsg.textContent = "";
}

doorBtn.addEventListener("click", () => {
  showToast("The door is closed.");
  openLock();
});

lockClose.addEventListener("click", closeLock);
window.addEventListener("keydown", (e) => {
  if (e.key === "Escape" && lockOpen) closeLock();
});

// click outside lock panel closes it (still at locked level)
camera.addEventListener("pointerdown", (e) => {
  if (!lockOpen) return;
  if (!lockPanel.contains(e.target)) closeLock();
});

/* ===================== LOCK WHEELS ===================== */
const letters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");
const CODE = CFG.code.toUpperCase();
const wheelState = new Array(CODE.length).fill(0);

function buildWheels(){
  wheelsEl.innerHTML = "";
  for(let i=0; i<CODE.length; i++){
    const w = document.createElement("div");
    w.className = "wheel";
    w.textContent = letters[wheelState[i]];

    w.addEventListener("wheel", (e) => {
      e.preventDefault();
      const dir = (e.deltaY > 0) ? -1 : 1;
      wheelState[i] = (wheelState[i] + dir + 26) % 26;
      w.textContent = letters[wheelState[i]];
    }, { passive:false });

    wheelsEl.appendChild(w);
  }
}
function enteredCode(){ return wheelState.map(i => letters[i]).join(""); }

buildWheels();

unlockBtn.addEventListener("click", () => {
  if (enteredCode() === CODE){
    showToast("Unlocked.");
    closeLock();
    // Hook next scene here
    // document.getElementById("intro").style.display = "none";
  } else {
    hintMsg.textContent = "Not quiteâ€¦";
  }
});
</script>
</body>
</html>
