<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Memory Door Â· Level 33</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Shippori+Mincho:wght@500;700&family=Zen+Maru+Gothic:wght@400;700&display=swap" rel="stylesheet">

<style>
:root{
  --title-font: "Shippori Mincho", serif;
  --ui-font: "Inter", "Zen Maru Gothic", system-ui, sans-serif;
}

html,body{
  margin:0; padding:0; height:100%;
  background:#000;
  overflow:hidden;
  font-family:var(--ui-font);
}

#intro{ position:fixed; inset:0; background:#000; }

/* ===== Title ===== */
#title-layer{
  position:absolute; inset:0;
  display:flex; align-items:center; justify-content:center;
  text-align:center; color:#fff;
  z-index:10; pointer-events:none;
  transition:opacity .4s ease;
  background: radial-gradient(circle at 50% 35%, rgba(255,255,255,.12), rgba(0,0,0,.90) 65%);
}
.title-wrap{ max-width:780px; padding:24px; }
.kicker{ letter-spacing:.35em; font-size:12px; opacity:.75; margin-bottom:16px; }
.title{
  font-family:var(--title-font);
  font-size:clamp(44px,6vw,68px);
  font-weight:700;
  line-height:1.05;
  text-shadow:0 20px 80px rgba(0,0,0,.8);
}
.subtitle{ margin-top:14px; font-size:14px; opacity:.8; }
.scroll{ margin-top:26px; display:flex; flex-direction:column; align-items:center; gap:10px; opacity:.9; }
.scroll-mouse{ width:22px;height:34px; border-radius:999px; border:1px solid rgba(255,255,255,.45); position:relative; }
.scroll-mouse::after{
  content:""; position:absolute; left:50%; top:6px;
  width:3px; height:6px; border-radius:999px; background:#fff;
  transform:translateX(-50%); animation:wheel 1.2s infinite;
}
@keyframes wheel{
  0%{opacity:.2;transform:translate(-50%,0)}
  50%{opacity:1}
  100%{opacity:.2;transform:translate(-50%,10px)}
}

/* ===== Scene ===== */
#scene{
  position:absolute; inset:0;
  opacity:0; transition:opacity .5s ease;
}

/* IMPORTANT: camera is the transformed layer */
#camera{
  position:absolute; inset:0;
  transform-origin: 50% 50%;
  will-change: transform;
}

/* Background image stays inside camera */
#scene-img{
  width:100%;
  height:100%;
  object-fit:cover;
  display:block;
}

/* Hotspots are INSIDE camera => no drifting */
.hotspot{
  position:absolute;
  border:none;
  background:transparent;
  cursor:pointer;
  z-index:2;
}

/* Doorbell hotspot: visible glow + pulse (findable) */
.hotspot.bell{
  border-radius:16px;
  background:radial-gradient(circle at 40% 35%,
    rgba(255,255,255,.35),
    rgba(255,255,255,.08) 55%,
    rgba(255,255,255,0) 70%);
  animation:bellPulse 1.6s ease-in-out infinite;
}
@keyframes bellPulse{
  0%{box-shadow:0 0 0 0 rgba(255,210,140,0)}
  50%{box-shadow:0 0 28px 6px rgba(255,210,140,.28)}
  100%{box-shadow:0 0 0 0 rgba(255,210,140,0)}
}

/* Hint (no music UI) */
#bell-hint{
  position:absolute;
  z-index:3;
  padding:10px 12px;
  border-radius:999px;
  color: rgba(255,255,255,0.92);
  background: rgba(0,0,0,0.42);
  border: 1px solid rgba(255,255,255,0.18);
  box-shadow: 0 16px 60px rgba(0,0,0,0.55);
  font-size: 13px;
  backdrop-filter: blur(6px);
  pointer-events:none;
}

/* ===== Smaller lock panel (on door) ===== */
#door-lock{
  position:absolute;
  z-index:4;
  display:none;
  width: min(320px, 76vw); /* smaller */
  padding: 12px 12px 10px;
  border-radius: 16px;
  background: rgba(255,255,255,.90);
  border: 1px solid rgba(255,255,255,.45);
  box-shadow: 0 24px 70px rgba(0,0,0,.42);
  backdrop-filter: blur(10px);
}
#door-lock.show{ display:block; }

.lock-title{
  font-family:"Zen Maru Gothic";
  font-weight:800;
  font-size:14px;
  color:#111827;
  margin-bottom:6px;
}
.lock-sub{ font-size:12px; color:#374151; margin-bottom:8px; }

.lock-wheels{
  display:flex; justify-content:center;
  gap:10px; margin: 8px 0 8px;
}
.wheel{
  width:42px; height:64px; /* smaller wheels */
  border-radius:14px;
  background:linear-gradient(#eef2ff,#dbeafe);
  border:1px solid #bfdbfe;
  display:flex; align-items:center; justify-content:center;
  font-family:"Zen Maru Gothic"; font-size:22px; font-weight:900;
  cursor:grab;
  user-select:none;
}
.unlock-btn{
  width:100%;
  padding:9px 12px;
  border-radius:999px;
  border:none;
  font-weight:900;
  cursor:pointer;
  background:linear-gradient(135deg,#fde68a,#fb923c);
}
.hint-message{ margin-top:8px; color:#b91c1c; font-weight:800; min-height:16px; font-size:12px; }

/* Toast */
#toast{
  position:absolute;
  left:50%; bottom:28px;
  transform:translateX(-50%);
  padding:10px 14px;
  background:rgba(0,0,0,.6);
  color:#fff;
  border-radius:999px;
  font-size:14px;
  opacity:0;
  transition:.2s;
  z-index:20;
}
#toast.show{ opacity:1; transform:translate(-50%,-6px); }
</style>
</head>

<body>
<div id="intro">

  <div id="title-layer">
    <div class="title-wrap">
      <div class="kicker">LEVEL 33</div>
      <div class="title">Memory Door</div>
      <div class="subtitle">Scroll to approach.</div>
      <div class="scroll"><div class="scroll-mouse"></div></div>
    </div>
  </div>

  <div id="scene">
    <!-- Everything that must stay aligned goes inside #camera -->
    <div id="camera">
      <img id="scene-img" src="door-bg.jpg" alt="Door hallway background"/>

      <!-- Hotspots (positions set from JS config) -->
      <button id="door-hotspot" class="hotspot door" aria-label="Door"></button>
      <button id="bell-hotspot" class="hotspot bell" aria-label="Doorbell"></button>

      <!-- Hint bubble (positioned near bell from JS config) -->
      <div id="bell-hint">ðŸ”” Tip: click the doorbell.</div>

      <!-- Lock panel (positioned on door from JS config) -->
      <div id="door-lock" aria-hidden="true">
        <div class="lock-title">Itâ€™s locked.</div>
        <div class="lock-sub">Enter the first code.</div>
        <div class="lock-wheels" id="lock-wheels"></div>
        <button class="unlock-btn" id="unlock-btn">Unlock</button>
        <div class="hint-message" id="hint-message"></div>
      </div>
    </div>

    <div id="toast" role="status" aria-live="polite"></div>
  </div>
</div>

<audio id="song" src="song.m4a" preload="auto"></audio>

<script>
/* ===================== CONFIG ===================== */
/* Tune these once, everything stays aligned (no ç§»ä½). */
const CFG = {
  code: "MEMORY",                // 6 letters here; wheels auto-match length
  focus: { x: 0.44, y: 0.52 },    // zoom focus point (door)
  zoomMax: 1.85,                 // clamp zoom so it doesn't get too big

  // Door hotspot (in normalized camera coords 0..1)
  door: { x: 0.34, y: 0.18, w: 0.28, h: 0.66 },

  // Doorbell hotspot: "above the white light switch" -> adjust x,y to match your image
  bell: { x: 0.56, y: 0.43, w: 0.09, h: 0.14 },

  // Lock panel position (on door). Smaller and anchored.
  lock: { x: 0.50, y: 0.42 } // center-ish on door; adjust
};

/* ===================== ELEMENTS ===================== */
const scene = document.getElementById("scene");
const titleLayer = document.getElementById("title-layer");
const camera = document.getElementById("camera");

const doorBtn = document.getElementById("door-hotspot");
const bellBtn = document.getElementById("bell-hotspot");
const bellHint = document.getElementById("bell-hint");

const lockPanel = document.getElementById("door-lock");
const wheelsEl = document.getElementById("lock-wheels");
const unlockBtn = document.getElementById("unlock-btn");
const hintMsg = document.getElementById("hint-message");

const toast = document.getElementById("toast");
const song = document.getElementById("song");

/* ===================== STATE ===================== */
let progress = 0;       // 0..1
let lockOpen = false;   // when true, zoom is frozen

/* ===================== HELPERS ===================== */
function clamp01(v){ return Math.max(0, Math.min(1, v)); }
function showToast(msg){
  toast.textContent = msg;
  toast.classList.add("show");
  setTimeout(() => toast.classList.remove("show"), 900);
}

function setRect(el, r){
  el.style.left   = (r.x * 100) + "%";
  el.style.top    = (r.y * 100) + "%";
  el.style.width  = (r.w * 100) + "%";
  el.style.height = (r.h * 100) + "%";
}

function setPoint(el, p){
  el.style.left = (p.x * 100) + "%";
  el.style.top  = (p.y * 100) + "%";
  el.style.transform = "translate(-50%, -50%)";
}

/* Place hotspots + hint + lock once (in camera coords) */
setRect(doorBtn, CFG.door);
setRect(bellBtn, CFG.bell);

// hint bubble sits to the right of the bell
bellHint.style.left = ((CFG.bell.x + CFG.bell.w + 0.01) * 100) + "%";
bellHint.style.top  = ((CFG.bell.y + CFG.bell.h * 0.25) * 100) + "%";
bellHint.style.transform = "translateY(-50%)";

// lock panel anchored by center point on the door
setPoint(lockPanel, CFG.lock);

/* ===================== CAMERA (NO DRIFT) ===================== */
function applyCamera(){
  // fade title -> scene
  const show = clamp01((progress - 0.10) / 0.30);
  scene.style.opacity = show.toFixed(3);
  titleLayer.style.opacity = (1 - show).toFixed(3);

  // zoom curve
  const t = clamp01(progress);
  const zoom = 1 + (CFG.zoomMax - 1) * (t * t);

  // pan to focus
  const vw = window.innerWidth;
  const vh = window.innerHeight;
  const dx = (0.5 - CFG.focus.x) * vw * (zoom - 1);
  const dy = (0.5 - CFG.focus.y) * vh * (zoom - 1);

  // transform camera (image + hotspots + lock all together)
  camera.style.transform = `translate(${dx}px, ${dy}px) scale(${zoom})`;
}

window.addEventListener("resize", applyCamera);

window.addEventListener("wheel", (e) => {
  if (lockOpen) return;       // freeze zoom when lock open
  e.preventDefault();
  progress = clamp01(progress - e.deltaY * 0.0007);
  applyCamera();
}, { passive:false });

applyCamera();

/* ===================== INTERACTIONS ===================== */
bellBtn.addEventListener("click", () => {
  showToast("ðŸ”” Ding...");
  try{
    song.currentTime = 0;
    song.play().catch(()=>{});
  }catch(_){}
  bellHint.style.opacity = "0.72";
});

doorBtn.addEventListener("click", () => {
  showToast("The door is closed.");
  lockOpen = true;
  lockPanel.classList.add("show");
  lockPanel.setAttribute("aria-hidden", "false");
  hintMsg.textContent = "";
});

/* ===================== LOCK ===================== */
const letters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");
const CODE = CFG.code.toUpperCase();
const wheelState = new Array(CODE.length).fill(0);

function buildWheels(){
  wheelsEl.innerHTML = "";
  for(let i=0; i<CODE.length; i++){
    const w = document.createElement("div");
    w.className = "wheel";
    w.textContent = letters[wheelState[i]];

    w.addEventListener("wheel", (e) => {
      e.preventDefault();
      const dir = (e.deltaY > 0) ? -1 : 1;
      wheelState[i] = (wheelState[i] + dir + 26) % 26;
      w.textContent = letters[wheelState[i]];
    }, { passive:false });

    wheelsEl.appendChild(w);
  }
}

function enteredCode(){
  return wheelState.map(i => letters[i]).join("");
}

buildWheels();

unlockBtn.addEventListener("click", () => {
  if (enteredCode() === CODE){
    showToast("Unlocked.");
    lockPanel.classList.remove("show");
    lockPanel.setAttribute("aria-hidden", "true");
    lockOpen = false;
  } else {
    hintMsg.textContent = "Not quiteâ€¦";
  }
});
</script>
</body>
</html>
